# Maintainer: gearhead <ys3al35l at gmail dot com>
# stolen from osmc. allows for a nice boot screen
#
pkgname=ply-lite-rune
_pkgname=ply-lite
pkgver=0.r10.76e20e8
pkgrel=1
pkgdesc="a plymouth lite spalsh screen"
url="https://github.com/T4d3o/Plymouth-lite.git"
arch=('armhf' 'arm64' 'amd64')
license=('GPLv2')
depends=('libpng16-16')
makedepends=('git' 'libpng-dev')
provides=('ply-lite')
conflicts=('ply-lite')
source=("$_pkgname::git+https://github.com/T4d3o/Plymouth-lite.git")
sha256sums=('SKIP')

pkgver() {
  cd "$_pkgname"
printf "0.r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
#  git describe --long --tags --always | sed 's/\([^-]*-g\)/r\1/;s/-/./g'
}

prepare() {
  cd "$_pkgname"
}

build() {
  cd "${srcdir}"/"$_pkgname"
  make -j4
}

package() {
  cd "$srcdir"/"$_pkgname"
  make -j4 DESTDIR="${pkgdir}" install
  # copy systemd files
  install -Dm 644 "$srcdir/$_pkgname/systemd/plymouth-lite-halt.service" \
	"$pkgdir/usr/lib/systemd/system/plymouth-lite-halt.service"
  install -Dm 644 "$srcdir/$_pkgname/systemd/plymouth-lite-poweroff.service" \
	"$pkgdir/usr/lib/systemd/system/plymouth-lite-poweroff.service"
  install -Dm 644 "$srcdir/$_pkgname/systemd/plymouth-lite-reboot.service" \
	"$pkgdir/usr/lib/systemd/system/plymouth-lite-reboot.service"
  install -Dm 644 "$srcdir/$_pkgname/systemd/plymouth-lite-start.service" \
	"$pkgdir/usr/lib/systemd/system/plymouth-lite-start.service"

}
